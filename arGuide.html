<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v7.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        .hidden { display: none; }
        .selection { display: flex; flex-direction: row; justify-content: center; }
        .selection > button {
            background-color: rgba(120, 196, 240, 0.849);
            margin: 1% 2%; padding: 2% 5%;
            border-radius: 30px; border: none;
        }
        .options > button {
            background-color: rgba(120, 196, 240, 0.849);
            padding: 1% 3%; margin-top: 10px;
            border: none;
        }
        #mrju, #hua {
            background-repeat: no-repeat;
            background-size: cover;
            height: 500px; position: absolute; width: 470px; top: -500px;
        }
        #mrju { background-image: url("assets/mrju.png"); }
        #hua { background-image: url("assets/hua.png"); }
        .namecard { color: rgb(129, 179, 223); }
        .options { display: flex; justify-content: flex-end; }
        .dialogue-box { left: 50%; }
        
        /* Responsive Design */
        @media (max-width: 1280px) {
            #mrju, #hua { height: 390px; width: 470px; top: -389px; left: -10%; }
            h3 { font-size: 16px; }
            .selection { margin-top: 7%; }
            .selection > button { padding: 2% 3%; }
        }
        @media (max-width: 576px) {
            h3 { font-size: 16px; }
            #mrju, #hua { height: 289px; width: 350px; top: -288px; left: -17%; }
            .selection { flex-direction: column; }
            .selection > button { margin: 4%; }
        }
        @media (max-width: 480px) {
            .dialogue-box { left: 50%; }
        }
        @media (max-width: 440px) {
            .selection { flex-direction: column; }
            .selection > button { margin: 4%; }
            .options > button { padding: 5%; }
            h3 { font-size: 14px; }
        }
    </style>
</head>
<body>
    <a-scene mindar-image="imageTargetSrc: assets/targets.mind; filterMinCF:0.0001; filterBeta: 0.001" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
        <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="near: 10; far: 30000; objects: .clickable"></a-camera>
        <a-entity target id="targetA" mindar-image-target="targetIndex: 0" rotation="75 0 0"></a-entity>
        <a-entity target id="targetB" mindar-image-target="targetIndex: 1" rotation="75 0 0"></a-entity>
        
        <div id="card_1" class="hidden clickable">
            <div id="mrju"></div>
            <div id="scene1" class="hidden">
                <h3 class="namecard">導覽員-小朱</h3>
                <h3 class="dialog">你好，我是小朱，接下來讓我為你解說門口這些美麗的陶片吧</h3>
                <div class="options"><button class="next-btn" data-next="card_4">請點選按鈕繼續</button></div>
            </div>
        </div>

        <div id="card_2" class="hidden">
            <div id="scene2">
                <h3 class="dialog">你來猜猜看牆面上的陶片尺寸是多少吧？</h3>
                <div class="selection">
                    <button id="optionA">A.冰掌(兵長)一米六</button>
                    <button id="optionB">B.10×20公分</button>
                    <button id="optionC">C.18×6公分</button>
                </div>
            </div>
        </div>

        <div id="card_3" class="hidden">
            <div id="mrju"></div>
            <div id="scene3">
                <h3 class="namecard">導覽員-小朱</h3>
                <h3 class="dialog">這些陶片的尺寸為10×20公分，剛上釉料時是無法看到色彩的，要等燒製完成後，顏色才會顯現出來，所以製作陶藝，就是一場藝術冒險哦。</h3>
                <div class="options"><button class="next-btn" data-next="card_4">請點選按鈕繼續</button></div>
            </div>
        </div>

        <div id="card_4" class="hidden">
            <div id="mrju"></div>
            <div id="scene4">
                <h3 class="namecard">導覽員-小朱</h3>
                <h3 class="dialog">而且每塊陶片都是由三到五位師傅共同創造出來的，他們在創作過程中互相合作，是非常有默契的藝術家團隊。等到陶片都燒製完成後，再固定在牆上，這些陶片的尺寸雖小，但背後蘊含著師傅們的心血和努力。</h3>
                <div class="options"><button class="next-btn" data-next="card_4">請點選按鈕繼續</button></div>
            </div>
        </div>

        <div id="card_5" class="hidden clickable">
            <div id="hua"></div>
            <div id="scene5" class="hidden">
                <h3 class="namecard">導覽員-小花</h3>
                <h3 class="dialog">讓我們一起進入這個神奇的展覽室吧，讓我們用眼睛和心靈一同仔細觀察這些作品！這個空間裡，充滿了繽紛絢麗的色彩，那話不多說，我們聽小朱為大家講解背後的小故事吧～</h3>
                <div class="options"><button class="next-btn" data-next="card_4">請點選按鈕繼續</button></div>
            </div>
        </div>
    </a-scene>
    <script>
        let audioContext, sourceNode;

        const resumeAudioContext = async () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            await audioContext.resume();
        };

        const getAudio = async (url) => {
            const response = await fetch(url);
            const buffer = await response.arrayBuffer();
            return audioContext.decodeAudioData(buffer);
        };

        const playMusic = async (url) => {
            await resumeAudioContext();
            const decodedData = await getAudio(url);
            sourceNode = audioContext.createBufferSource();
            sourceNode.buffer = decodedData;
            sourceNode.connect(audioContext.destination);
            sourceNode.start();
        };

        const pauseMusic = () => {
            if (sourceNode) {
                sourceNode.stop();
            }
        };

        document.addEventListener("DOMContentLoaded", () => {
            const sceneEl = document.querySelector('a-scene');
            let arSystem;

            sceneEl.addEventListener('loaded', () => {
                arSystem = sceneEl.systems["mindar-image-system"];

                const targets = [
                    { id: 'targetA', sceneId: 'scene1', cardId: 'card_1', music: 'assets/1-3.wav' },
                    { id: 'targetB', sceneId: 'scene5', cardId: 'card_5', music: 'assets/2.wav' }
                ];

                targets.forEach(target => {
                    const { id, sceneId, cardId, music } = target;
                    const entity = document.querySelector(`#${id}`);
                    const card = document.querySelector(`#${cardId}`);
                    const scene = document.querySelector(`#${sceneId}`);
                    entity.addEventListener("targetFound", (event) => {
                        card.classList.remove('hidden');
                        scene.classList.remove('hidden');
                        playMusic(music);
                    });
                    entity.addEventListener("targetLost", (event) => {
                        card.classList.add('hidden');
                        scene.classList.add('hidden');
                        pauseMusic();
                    });
                });

                const nextButtons = document.querySelectorAll('.next-btn');
                nextButtons.forEach(button => {
                    button.addEventListener('click', (event) => {
                        const nextCardId = event.target.dataset.next;
                        if (nextCardId) {
                            document.querySelector(`#${nextCardId}`).classList.remove('hidden');
                        }
                        event.target.closest('.hidden').classList.add('hidden');
                    });
                });

                document.querySelector('#optionA').addEventListener('click', (event) => {
                    alert('猜錯囉~請再猜一次');
                });

                document.querySelector('#optionB').addEventListener('click', (event) => {
                    document.querySelector('#card_3').classList.remove('hidden');
                    document.querySelector('#card_2').classList.add('hidden');
                });

                document.querySelector('#optionC').addEventListener('click', (event) => {
                    alert('猜錯囉~請再猜一次');
                });
            });
        });
    </script>
</body>
</html>
