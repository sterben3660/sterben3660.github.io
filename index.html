

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>testwebar</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.0/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <script> 
    let audioContext;
    let sourceNode;
    // const resumeAudioContext = async () => {
    //   audioContext = new (window.AudioContext || window.webkitAudioContext)();
    //   await audioContext.resume();
    // };

    // const getAudio = async (url) => {
    //   const response = await fetch(url);
    //   const buffer = await response.arrayBuffer();
    //   return buffer;
    // }

    // const playMusic = async () => {
    //   if (!audioContext) {
    //     await resumeAudioContext();
    //   }
    //   const audioBuffer = await getAudio('assets/accompaniment.mp3');
    //   const decodedData = await audioContext.decodeAudioData(audioBuffer);
    //   sourceNode = audioContext.createBufferSource();
    //   sourceNode.buffer = decodedData;
    //   sourceNode.connect(audioContext.destination);
    //   sourceNode.start();
    // }
    async function getAudio() {
    const context = new (window.AudioContext || window.webkitAudioContext)();
    const response = await fetch('assets/accompaniment.mp3');
    const arrayBuffer = await response.arrayBuffer();
    const audioBuffer = await context.decodeAudioData(arrayBuffer);
    return audioBuffer;
    }

    async function playAudio() {
      try {
      const audioBuffer = await getAudio();
      const context = new (window.AudioContext || window.webkitAudioContext)();
      const source = context.createBufferSource();
      source.buffer = audioBuffer;
      source.connect(context.destination);
      source.start();
    } catch (error) {
      console.error('Error with fetching or decoding audio data', error);
    }
  }

playAudio();

    const pauseMusic = () => {
      if (sourceNode) {
        sourceNode.stop();
      }
    }
    const sceneEl = document.querySelector("a-scene");
      let arSystem;

      sceneEl.addEventListener("loaded", function () {
        arSystem = sceneEl.systems["mindar-image-system"];
      });

      const targetA = document.querySelector("#targetA");

      // 設置 targetFound 的事件
      targetA.addEventListener("targetFound", async event => {
        await playMusic();
      });

      // 設置 targetLost 的事件
      targetA.addEventListener("targetLost", event => {
        pauseMusic();
      });
  </script>
<body>
  <a-scene
  mindar-image="imageTargetSrc: assets/targets.mind" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-camera look-controls="enabled: false"></a-camera>

    <a-entity target id="targetA" mindar-image-target="targetIndex: 0" rotation="75 0 0">
      <a-box scale="0.5 0.5 0.5" color="#78C3E8"> </a-box>
    </a-entity>
  </a-scene>


</body>
</html>





